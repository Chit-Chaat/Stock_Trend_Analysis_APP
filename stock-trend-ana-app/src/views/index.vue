<template>
  <el-container>
    <el-header>
      <el-select v-model="stock_ticker" filterable placeholder="Choose a Stock" style="width: 300px;">
        <el-option v-for="item in ticker_options" :key="item.value" :label="item.label" :value="item.value">
        </el-option>
      </el-select>
      <el-date-picker style="margin-left: 20px; margin-right: 20px; " v-model="start_date" align="right" type="date"
        placeholder="Specify Date" :picker-options="pickerOptions">
      </el-date-picker>
      <el-button type="success" icon="el-icon-upload2" style="width: 180px;" @click="load_history">Load History
      </el-button>
      <el-button type="primary" style="margin-left:20px; width: 180px;">Predict Future<i
          class="el-icon-search el-icon--right"></i></el-button>
    </el-header>
    <el-main id="index_content">
      <div id="echartContainer" ref="echartContainer" style="width:100%; height:380px"></div>
    </el-main>
  </el-container>
</template>

<script>
  var echarts = require("echarts");
  import axios from "axios"
  export default {
    data() {
      return {
        basicDataApiPrefix: "/analysis/basic/",
        ticker_options: [{
          value: 'AMZN',
          label: 'AMZN (Amazon)'
        }, {
          value: 'BOTZ',
          label: 'BOTZ (Robotics & AI ETF)'
        }, {
          value: 'GOOG',
          label: 'GOOG (Google)'
        }, {
          value: 'FB',
          label: 'FB (Facebook)'
        }, {
          value: 'AAPL',
          label: 'AAPL (Apple)'
        }, {
          value: 'NFLX',
          label: 'NFLX (Netflix)'
        }, {
          value: 'MSFT',
          label: 'MSFT (Microsoft)'
        }, {
          value: 'XLK',
          label: 'XLK (SPDR Fund)'
        }
        ],
        stock_ticker: '',
        pickerOptions: {
          disabledDate(time) {
            return time.getTime() > Date.now();
          },
          shortcuts: [{
            text: 'Today',
            onClick(picker) {
              picker.$emit('pick', new Date());
            }
          }, {
            text: 'Yesterday',
            onClick(picker) {
              const date = new Date();
              date.setTime(date.getTime() - 3600 * 1000 * 24);
              picker.$emit('pick', date);
            }
          }, {
            text: 'A week ago',
            onClick(picker) {
              const date = new Date();
              date.setTime(date.getTime() - 3600 * 1000 * 24 * 7);
              picker.$emit('pick', date);
            }
          }, {
            text: 'A month ago',
            onClick(picker) {
              const date = new Date();
              date.setTime(date.getTime() - 3600 * 1000 * 24 * 31);
              picker.$emit('pick', date);
            }
          }, {
            text: 'A year ago',
            onClick(picker) {
              const date = new Date();
              date.setTime(date.getTime() - 3600 * 1000 * 24 * 365);
              picker.$emit('pick', date);
            }
          }, {
            text: 'Two year ago',
            onClick(picker) {
              const date = new Date();
              date.setTime(date.getTime() - 3600 * 1000 * 24 * 365 * 2);
              picker.$emit('pick', date);
            }
          }

          ]
        },
        start_date: '',
        stock_data: [
          [1369, "2020-06-11", 2603.5, 2557.9599609375, 2536.22998046875, 2671.3798828125, 5800100], 
          [1370, "2020-06-12", 2601.2099609375, 2545.02001953125, 2503.35009765625, 2621.47998046875, 5436100], 
          [1371, "2020-06-15", 2526.60009765625, 2572.679931640625, 2508.0, 2584.0, 3865100], 
          [1372, "2020-06-16", 2620.0, 2615.27001953125, 2576.0, 2620.0, 3585600], [1373, "2020-06-17", 2647.5, 2640.97998046875, 2631.820068359375, 2655.0, 2959300], [1374, "2020-06-18", 2647.010009765625, 2653.97998046875, 2636.110107421875, 2659.639892578125, 2487800], [1375, "2020-06-19", 2678.080078125, 2675.010009765625, 2659.0, 2697.429931640625, 5777000], [1376, "2020-06-22", 2684.5, 2713.820068359375, 2669.0, 2715.0, 3208800], [1377, "2020-06-23", 2726.02001953125, 2764.409912109375, 2718.0400390625, 2783.110107421875, 4231700], [1378, "2020-06-24", 2780.0, 2734.39990234375, 2721.0, 2796.0, 4526600], [1379, "2020-06-25", 2739.550048828125, 2754.580078125, 2712.139892578125, 2756.22998046875, 2968700], [1380, "2020-06-26", 2775.06005859375, 2692.8701171875, 2688.0, 2782.570068359375, 6500800], [1381, "2020-06-29", 2690.010009765625, 2680.3798828125, 2630.080078125, 2696.800048828125, 4223400], [1382, "2020-06-30", 2685.070068359375, 2758.820068359375, 2675.030029296875, 2769.6298828125, 3769700], [1383, "2020-07-01", 2757.989990234375, 2878.699951171875, 2754.0, 2895.0, 6363400], [1384, "2020-07-02", 2912.010009765625, 2890.300048828125, 2871.10009765625, 2955.56005859375, 6593400], [1385, "2020-07-06", 2934.969970703125, 3057.0400390625, 2930.0, 3059.8798828125, 6880600], [1386, "2020-07-07", 3058.550048828125, 3000.1201171875, 2990.0, 3069.550048828125, 5257500], [1387, "2020-07-08", 3022.610107421875, 3081.110107421875, 3012.429931640625, 3083.969970703125, 5037600], [1388, "2020-07-09", 3115.989990234375, 3182.6298828125, 3074.0, 3193.8798828125, 6388700], [1389, "2020-07-10", 3191.760009765625, 3200.0, 3135.699951171875, 3215.0, 5486000], [1390, "2020-07-13", 3251.06005859375, 3104.0, 3068.389892578125, 3344.2900390625, 7720400], [1391, "2020-07-14", 3089.0, 3084.0, 2950.0, 3127.3798828125, 7231900], [1392, "2020-07-15", 3080.22998046875, 3008.8701171875, 2973.179931640625, 3098.35009765625, 5788900], [1393, "2020-07-16", 2971.06005859375, 2999.89990234375, 2918.22998046875, 3032.0, 6394200], [1394, "2020-07-17", 3009.0, 2961.969970703125, 2948.449951171875, 3024.0, 4761300], [1395, "2020-07-20", 3000.199951171875, 3196.840087890625, 2994.02001953125, 3201.360107421875, 7598200], [1396, "2020-07-21", 3232.489990234375, 3138.2900390625, 3105.719970703125, 3240.580078125, 6135000], [1397, "2020-07-22", 3125.0, 3099.909912109375, 3065.260009765625, 3150.0, 4104200], [1398, "2020-07-23", 3098.27001953125, 2986.550048828125, 2970.0, 3098.27001953125, 5656900], [1399, "2020-07-24", 2930.0, 3008.909912109375, 2888.0, 3031.580078125, 5632400], [1400, "2020-07-27", 3062.0, 3055.2099609375, 3015.77001953125, 3098.0, 4170500], [1401, "2020-07-28", 3054.27001953125, 3000.330078125, 2995.760009765625, 3077.090087890625, 3126700], [1402, "2020-07-29", 3030.989990234375, 3033.530029296875, 2996.77001953125, 3039.159912109375, 2974100], [1403, "2020-07-30", 3014.0, 3051.8798828125, 3005.0, 3092.0, 6128300], [1404, "2020-07-31", 3244.0, 3164.679931640625, 3151.0, 3246.820068359375, 8085500], [1405, "2020-08-03", 3180.510009765625, 3111.889892578125, 3104.0, 3184.0, 5074700], [1406, "2020-08-04", 3101.2099609375, 3138.830078125, 3101.2099609375, 3167.239990234375, 4694300], [1407, "2020-08-05", 3143.77001953125, 3205.030029296875, 3127.300048828125, 3213.590087890625, 3930000], [1408, "2020-08-06", 3194.360107421875, 3225.0, 3165.429931640625, 3247.469970703125, 3940600], [1409, "2020-08-07", 3224.010009765625, 3167.4599609375, 3140.669921875, 3240.81005859375, 3936100], [1410, "2020-08-10", 3170.31005859375, 3148.159912109375, 3101.52001953125, 3172.510009765625, 3167300], [1411, "2020-08-11", 3113.199951171875, 3080.669921875, 3073.0, 3159.219970703125, 3718100], [1412, "2020-08-12", 3108.0, 3162.239990234375, 3101.419921875, 3174.389892578125, 3527200], [1413, "2020-08-13", 3182.989990234375, 3161.02001953125, 3155.0, 3217.52001953125, 3149000], [1414, "2020-08-14", 3178.179931640625, 3148.02001953125, 3120.0, 3178.239990234375, 2751700], [1415, "2020-08-17", 3173.1201171875, 3182.409912109375, 3154.179931640625, 3194.969970703125, 2691200], [1416, "2020-08-18", 3212.0, 3312.489990234375, 3205.820068359375, 3320.0, 5346000], [1417, "2020-08-19", 3303.010009765625, 3260.47998046875, 3256.0, 3315.89990234375, 4185100], [1418, "2020-08-20", 3252.0, 3297.3701171875, 3238.0, 3312.6201171875, 3332500], [1419, "2020-08-21", 3295.0, 3284.719970703125, 3275.389892578125, 3314.39990234375, 3575900], [1420, "2020-08-24", 3310.14990234375, 3307.4599609375, 3257.56005859375, 3380.320068359375, 4666300], [1421, "2020-08-25", 3294.989990234375, 3346.489990234375, 3267.0, 3357.39990234375, 3992800], [1422, "2020-08-26", 3351.110107421875, 3441.85009765625, 3344.570068359375, 3451.739990234375, 6508700], [1423, "2020-08-27", 3450.050048828125, 3400.0, 3378.0, 3453.0, 4264800], [1424, "2020-08-28", 3423.0, 3401.800048828125, 3386.5, 3433.3701171875, 2897000], [1425, "2020-08-31", 3408.989990234375, 3450.9599609375, 3405.0, 3495.0, 4185900], [1426, "2020-09-01", 3489.580078125, 3499.1201171875, 3467.0, 3513.8701171875, 3476400], [1427, "2020-09-02", 3547.0, 3531.449951171875, 3486.68994140625, 3552.25, 3931500], [1428, "2020-09-03", 3485.0, 3368.0, 3303.0, 3488.409912109375, 8161100], [1429, "2020-09-04", 3318.0, 3294.6201171875, 3111.1298828125, 3381.5, 8781800], [1430, "2020-09-08", 3144.0, 3149.840087890625, 3130.0, 3250.85009765625, 6094200], [1431, "2020-09-09", 3202.989990234375, 3268.610107421875, 3185.0, 3303.179931640625, 5188700], [1432, "2020-09-10", 3307.219970703125, 3175.110107421875, 3170.550048828125, 3349.889892578125, 5330700], [1433, "2020-09-11", 3208.68994140625, 3116.219970703125, 3083.97998046875, 3217.340087890625, 5094000], [1434, "2020-09-14", 3172.93994140625, 3102.969970703125, 3096.0, 3187.389892578125, 4529600], [1435, "2020-09-15", 3136.159912109375, 3156.1298828125, 3108.919921875, 3175.02001953125, 4021500], [1436, "2020-09-16", 3179.989990234375, 3078.10009765625, 3074.14990234375, 3187.239990234375, 4512200], [1437, "2020-09-17", 3009.25, 3008.72998046875, 2972.550048828125, 3029.429931640625, 6449100], [1438, "2020-09-18", 3031.739990234375, 2954.909912109375, 2905.5400390625, 3037.800048828125, 8892600], [1439, "2020-09-21", 2906.5, 2960.469970703125, 2871.0, 2962.0, 6117900], [1440, "2020-09-22", 3033.840087890625, 3128.989990234375, 3000.199951171875, 3133.989990234375, 6948800], [1441, "2020-09-23", 3120.429931640625, 2999.860107421875, 2992.3798828125, 3127.0, 5652700], [1442, "2020-09-24", 2977.7900390625, 3019.7900390625, 2965.0, 3069.300048828125, 5529400], [1443, "2020-09-25", 3054.860107421875, 3095.1298828125, 2999.0, 3101.5400390625, 4615200], [1444, "2020-09-28", 3148.85009765625, 3174.050048828125, 3117.169921875, 3175.0400390625, 4224200], [1445, "2020-09-29", 3175.389892578125, 3144.8798828125, 3132.5400390625, 3188.260009765625, 3495800], [1446, "2020-09-30", 3141.139892578125, 3148.72998046875, 3133.989990234375, 3212.8798828125, 4896100], [1447, "2020-10-01", 3208.0, 3221.260009765625, 3172.0, 3224.0, 4971900], [1448, "2020-10-02", 3153.6298828125, 3125.0, 3123.0, 3195.800048828125, 5613100], [1449, "2020-10-05", 3145.840087890625, 3199.199951171875, 3140.85009765625, 3202.530029296875, 3775300], [1450, "2020-10-06", 3165.0, 3099.9599609375, 3090.0, 3182.0, 5086900], [1451, "2020-10-07", 3135.0, 3195.68994140625, 3132.389892578125, 3200.0, 4309400], [1452, "2020-10-08", 3224.989990234375, 3190.550048828125, 3174.989990234375, 3233.2900390625, 3174100], [1453, "2020-10-09", 3210.0, 3286.64990234375, 3197.830078125, 3288.989990234375, 4907900], [1454, "2020-10-12", 3349.93994140625, 3442.929931640625, 3339.550048828125, 3496.239990234375, 8364200], [1455, "2020-10-13", 3467.989990234375, 3443.6298828125, 3424.219970703125, 3492.3798828125, 5744700], [1456, "2020-10-14", 3447.0, 3363.7099609375, 3340.0, 3464.8798828125, 5828900], [1457, "2020-10-15", 3292.010009765625, 3338.64990234375, 3280.0, 3355.8798828125, 5223400], [1458, "2020-10-16", 3363.22998046875, 3272.7099609375, 3160.0, 3399.659912109375, 6474400], [1459, "2020-10-19", 3299.610107421875, 3207.2099609375, 3192.739990234375, 3329.0, 5223600], [1460, "2020-10-20", 3222.280029296875, 3217.010009765625, 3192.010009765625, 3266.0, 4509700], [1461, "2020-10-21", 3212.5, 3184.93994140625, 3160.0, 3233.8798828125, 4592700], [1462, "2020-10-22", 3189.8701171875, 3176.39990234375, 3121.93994140625, 3198.75, 4212000], [1463, "2020-10-23", 3191.0, 3204.39990234375, 3140.0, 3205.330078125, 3466700], [1464, "2020-10-26", 3198.739990234375, 3207.0400390625, 3153.300048828125, 3282.97998046875, 5901200], [1465, "2020-10-27", 3224.93994140625, 3286.330078125, 3211.300048828125, 3291.659912109375, 4291000], [1466, "2020-10-28", 3249.300048828125, 3162.780029296875, 3162.469970703125, 3264.02001953125, 5588300], [1467, "2020-10-29", 3201.27001953125, 3211.010009765625, 3164.0, 3257.25, 6596500], [1468, "2020-10-30", 3157.75, 3036.14990234375, 3019.0, 3167.0, 8386400], [1469, "2020-11-02", 3061.739990234375, 3004.47998046875, 2950.1201171875, 3079.7099609375, 7257400], [1470, "2020-11-03", 3018.530029296875, 3048.409912109375, 2980.97998046875, 3074.89990234375, 4897900], [1471, "2020-11-04", 3159.989990234375, 3241.159912109375, 3139.72998046875, 3244.85009765625, 6839000], [1472, "2020-11-05", 3319.969970703125, 3322.0, 3288.8798828125, 3366.800048828125, 5789300], [1473, "2020-11-06", 3304.639892578125, 3311.3701171875, 3232.0, 3322.0, 4647300], [1474, "2020-11-09", 3231.030029296875, 3143.739990234375, 3112.110107421875, 3289.0, 7190400], [1475, "2020-11-10", 3095.02001953125, 3035.02001953125, 3019.47998046875, 3114.0, 6591000], [1476, "2020-11-11", 3061.780029296875, 3137.389892578125, 3050.0, 3139.14990234375, 4366900], [1477, "2020-11-12", 3159.949951171875, 3110.280029296875, 3086.050048828125, 3175.8798828125, 4362000], [1478, "2020-11-13", 3122.0, 3128.81005859375, 3085.389892578125, 3141.719970703125, 3756200], [1479, "2020-11-16", 3093.199951171875, 3131.06005859375, 3072.68994140625, 3142.699951171875, 3808700], [1480, "2020-11-17", 3183.5400390625, 3135.659912109375, 3135.260009765625, 3189.25, 3444700], [1481, "2020-11-18", 3134.0, 3105.4599609375, 3105.10009765625, 3140.0, 2916800], [1482, "2020-11-19", 3105.31005859375, 3117.02001953125, 3080.919921875, 3125.0, 3010300], [1483, "2020-11-20", 3117.02001953125, 3099.39990234375, 3098.050048828125, 3132.889892578125, 3374400], [1484, "2020-11-23", 3116.699951171875, 3098.389892578125, 3065.4599609375, 3139.75, 4708900], [1485, "2020-11-24", 3100.5, 3118.06005859375, 3086.260009765625, 3134.25, 3602100], [1486, "2020-11-25", 3141.8701171875, 3185.070068359375, 3140.260009765625, 3198.0, 3790400], [1487, "2020-11-27", 3211.260009765625, 3195.340087890625, 3190.050048828125, 3216.18994140625, 2392900], [1488, "2020-11-30", 3208.47998046875, 3168.0400390625, 3125.550048828125, 3228.389892578125, 4063900], [1489, "2020-12-01", 3188.5, 3220.080078125, 3157.179931640625, 3248.949951171875, 4544400], [1490, "2020-12-02", 3221.64990234375, 3203.530029296875, 3173.260009765625, 3232.0, 3129300], [1491, "2020-12-03", 3205.4599609375, 3186.72998046875, 3181.31005859375, 3228.639892578125, 2892000], [1492, "2020-12-04", 3198.2099609375, 3162.580078125, 3158.760009765625, 3198.2099609375, 2913600], [1493, "2020-12-07", 3156.47998046875, 3158.0, 3141.68994140625, 3180.760009765625, 2751300], [1494, "2020-12-08", 3158.89990234375, 3177.2900390625, 3120.02001953125, 3184.1298828125, 3286300], [1495, "2020-12-09", 3167.889892578125, 3104.199951171875, 3088.0, 3174.429931640625, 4100800], [1496, "2020-12-10", 3088.989990234375, 3101.489990234375, 3076.0, 3142.10009765625, 3030200], [1497, "2020-12-11", 3096.659912109375, 3116.419921875, 3072.820068359375, 3118.669921875, 3064700], [1498, "2020-12-14", 3143.0, 3156.969970703125, 3126.0, 3190.469970703125, 4155800], [1499, "2020-12-15", 3181.010009765625, 3165.1201171875, 3130.489990234375, 3188.5, 3323700], [1500, "2020-12-16", 3176.010009765625, 3240.9599609375, 3163.679931640625, 3247.0, 4427600], [1501, "2020-12-17", 3250.0, 3236.080078125, 3221.0, 3263.510009765625, 3474300], [1502, "2020-12-18", 3243.989990234375, 3201.64990234375, 3171.60009765625, 3249.419921875, 5995700], [1503, "2020-12-21", 3200.010009765625, 3206.179931640625, 3166.0, 3226.969970703125, 3836800], [1504, "2020-12-22", 3202.840087890625, 3206.52001953125, 3180.080078125, 3222.0, 2369400], [1505, "2020-12-23", 3205.0, 3185.27001953125, 3184.169921875, 3210.1298828125, 2093800], [1506, "2020-12-24", 3193.89990234375, 3172.68994140625, 3169.0, 3202.0, 1451900], [1507, "2020-12-28", 3194.0, 3283.9599609375, 3172.68994140625, 3304.0, 5686800], [1508, "2020-12-29", 3309.93994140625, 3322.0, 3281.219970703125, 3350.64990234375, 4872900], [1509, "2020-12-30", 3341.0, 3285.85009765625, 3282.469970703125, 3342.10009765625, 3209300], [1510, "2020-12-31", 3275.0, 3256.929931640625, 3241.199951171875, 3282.919921875, 2957200], [1511, "2021-01-04", 3270.0, 3186.6298828125, 3144.02001953125, 3272.0, 4411400], [1512, "2021-01-05", 3166.010009765625, 3218.510009765625, 3165.06005859375, 3223.3798828125, 2655500], [1513, "2021-01-06", 3146.47998046875, 3138.3798828125, 3131.159912109375, 3197.510009765625, 4394800], [1514, "2021-01-07", 3157.0, 3162.159912109375, 3155.0, 3208.5400390625, 3514500], [1515, "2021-01-08", 3180.0, 3182.699951171875, 3142.199951171875, 3190.639892578125, 3537700], [1516, "2021-01-11", 3148.010009765625, 3114.2099609375, 3110.0, 3156.3798828125, 3683400], [1517, "2021-01-12", 3120.0, 3120.830078125, 3086.0, 3142.139892578125, 3514600], [1518, "2021-01-13", 3128.43994140625, 3165.889892578125, 3122.080078125, 3189.949951171875, 3321200], [1519, "2021-01-14", 3167.52001953125, 3127.469970703125, 3120.590087890625, 3178.0, 3070900], [1520, "2021-01-15", 3123.02001953125, 3104.25, 3095.169921875, 3142.550048828125, 4244000], [1521, "2021-01-19", 3107.0, 3120.760009765625, 3096.0, 3145.0, 3305100], [1522, "2021-01-20", 3181.989990234375, 3263.3798828125, 3175.0, 3279.800048828125, 5309800], [1523, "2021-01-21", 3293.0, 3306.989990234375, 3289.570068359375, 3348.550048828125, 4945100], [1524, "2021-01-22", 3304.31005859375, 3292.22998046875, 3283.159912109375, 3321.909912109375, 2821900], [1525, "2021-01-25", 3328.5, 3294.0, 3243.14990234375, 3363.889892578125, 3749800], [1526, "2021-01-26", 3296.360107421875, 3326.1298828125, 3282.8701171875, 3338.0, 2955200], [1527, "2021-01-27", 3341.489990234375, 3232.580078125, 3207.080078125, 3346.52001953125, 4660200], [1528, "2021-01-28", 3235.0400390625, 3237.6201171875, 3228.68994140625, 3301.679931640625, 3149200], [1529, "2021-01-29", 3230.0, 3206.199951171875, 3184.550048828125, 3236.989990234375, 4285600], [1530, "2021-02-01", 3242.360107421875, 3342.8798828125, 3235.030029296875, 3350.260009765625, 4160200], [1531, "2021-02-02", 3380.0, 3380.0, 3361.1298828125, 3427.739990234375, 7098600], [1532, "2021-02-03", 3425.010009765625, 3312.530029296875, 3308.6201171875, 3434.0, 7088800], [1533, "2021-02-04", 3330.0, 3331.0, 3277.75, 3347.0, 3670700], [1534, "2021-02-05", 3319.0, 3352.14990234375, 3302.7099609375, 3377.0, 3613600], [1535, "2021-02-08", 3358.5, 3322.93994140625, 3304.0, 3365.0, 3257400], [1536, "2021-02-09", 3312.489990234375, 3305.0, 3297.840087890625, 3338.0, 2203500], [1537, "2021-02-10", 3314.0, 3286.580078125, 3254.0, 3317.949951171875, 3151600], [1538, "2021-02-11", 3292.0, 3262.1298828125, 3248.06005859375, 3292.0, 2295800], [1539, "2021-02-12", 3250.0, 3277.7099609375, 3233.31005859375, 3280.25, 2329300], [1540, "2021-02-16", 3254.050048828125, 3268.949951171875, 3253.590087890625, 3308.300048828125, 2574700], [1541, "2021-02-17", 3263.60009765625, 3308.639892578125, 3259.5, 3320.909912109375, 3297500], [1542, "2021-02-18", 3282.419921875, 3328.22998046875, 3273.93994140625, 3338.0, 3027400], [1543, "2021-02-19", 3328.22998046875, 3249.89990234375, 3245.75, 3333.5, 4305200], [1544, "2021-02-22", 3208.1298828125, 3180.739990234375, 3172.260009765625, 3232.320068359375, 3515700], [1545, "2021-02-23", 3127.030029296875, 3194.5, 3093.60009765625, 3204.72998046875, 4677200], [1546, "2021-02-24", 3166.75, 3159.530029296875, 3125.3798828125, 3171.22998046875, 3011300], [1547, "2021-02-25", 3136.739990234375, 3057.159912109375, 3047.760009765625, 3178.260009765625, 4533800], [1548, "2021-02-26", 3095.199951171875, 3092.929931640625, 3036.699951171875, 3122.43994140625, 4273500], [1549, "2021-03-01", 3127.889892578125, 3146.139892578125, 3097.989990234375, 3149.56005859375, 2729100], [1550, "2021-03-02", 3143.469970703125, 3094.530029296875, 3087.1201171875, 3163.52001953125, 2590000], [1551, "2021-03-03", 3081.179931640625, 3005.0, 2995.0, 3107.780029296875, 3967200], [1552, "2021-03-04", 3012.0, 2977.570068359375, 2945.429931640625, 3058.1298828125, 5458700], [1553, "2021-03-05", 3005.0, 3000.4599609375, 2881.0, 3009.0, 5383400], [1554, "2021-03-08", 3015.0, 2951.949951171875, 2951.31005859375, 3064.590087890625, 4178500], [1555, "2021-03-09", 3017.989990234375, 3062.85009765625, 3005.14990234375, 3090.9599609375, 4023500], [1556, "2021-03-10", 3098.449951171875, 3057.639892578125, 3030.050048828125, 3116.4599609375, 3008700], [1557, "2021-03-11", 3104.010009765625, 3113.590087890625, 3082.929931640625, 3131.780029296875, 2770800], [1558, "2021-03-12", 3075.0, 3089.489990234375, 3045.5, 3098.97998046875, 2418500], [1559, "2021-03-15", 3074.570068359375, 3081.679931640625, 3032.090087890625, 3082.239990234375, 2913600], [1560, "2021-03-16", 3104.969970703125, 3091.860107421875, 3075.860107421875, 3128.909912109375, 2510100], [1561, "2021-03-17", 3073.219970703125, 3135.72998046875, 3070.219970703125, 3173.050048828125, 3100900], [1562, "2021-03-18", 3101.0, 3027.989990234375, 3025.0, 3116.6298828125, 3649600], [1563, "2021-03-19", 3029.22998046875, 3074.9599609375, 3016.6298828125, 3077.2900390625, 4616400], [1564, "2021-03-22", 3067.85009765625, 3110.8701171875, 3060.050048828125, 3126.580078125, 2902200], [1565, "2021-03-23", 3127.0, 3137.5, 3120.85009765625, 3182.0, 3817300], [1566, "2021-03-24", 3151.0400390625, 3087.070068359375, 3085.14990234375, 3160.31005859375, 2959000], [1567, "2021-03-25", 3072.989990234375, 3046.260009765625, 3037.139892578125, 3109.780029296875, 3563500], [1568, "2021-03-26", 3044.06005859375, 3052.030029296875, 2996.0, 3056.659912109375, 3306700], [1569, "2021-03-29", 3055.43994140625, 3075.72998046875, 3028.449951171875, 3091.25, 2746000], [1570, "2021-03-30", 3070.010009765625, 3055.2900390625, 3034.0, 3073.0, 2334300]

        ],

      }
    },
    mounted() {
      var upColor = '#67C23A';
      var downColor = '#F56C6C';
      var orginalData = this.splitData(this.stock_data);
      console.log(orginalData.volumes)
      // keep this func calculateM in mounted area.
      function calculateMA(dayCount) {
        var result = [];
        for (var i = 0, len = orginalData.values.length; i < len; i++) {
          if (i < dayCount) {
            result.push("-");
            continue;
          }
          var sum = 0;
          for (var j = 0; j < dayCount; j++) {
            sum += orginalData.values[i - j][1];
          }
          result.push(sum / dayCount);
        }
        return result;
      }

      var option = {
        animation: false,
        legend: {
          bottom: 360,
          left: 'center',
          data: ['Daily Value', 'MA5', 'MA10', 'MA20', 'MA30']
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'cross'
          },
          borderWidth: 1,
          borderColor: '#E4E7ED',
          padding: 10,
          textStyle: {
            color: '#909399'
          },
          position: function (pos, params, el, elRect, size) {
            var obj = { top: 10 };
            obj[['left', 'right'][+(pos[0] < size.viewSize[0] / 2)]] = 30;
            return obj;
          },
          extraCssText: 'width: 230px'
        },
        axisPointer: {
          link: { xAxisIndex: 'all' },
          label: {
            backgroundColor: '#409EFF'
          }
        },
        toolbox: {
          feature: {
            dataZoom: {
              yAxisIndex: false
            },
            brush: {
              type: ['lineX', 'clear']
            }
          }
        },
        brush: {
          xAxisIndex: 'all',
          brushLink: 'all',
          outOfBrush: {
            colorAlpha: 0.3
          }
        },
        visualMap: {
          show: false,
          seriesIndex: 5,
          dimension: 2,
          pieces: [{
            value: 1,
            color: downColor
          }, {
            value: -1,
            color: upColor
          }]
        },
        grid: [
          {
            // candle chart
            left: "3%",
            right: "3%",
            top: "0",
            height: "75%"
          },
          {
            // volume bar chart
            left: "3%",
            right: "3%",
            top: "80%",
            height: "10%"
          }
        ],
        xAxis: [
          {
            type: "category",
            data: orginalData.categoryData,
            scale: true,
            boundaryGap: false,
            axisLine: {
              onZero: false,
              lineStyle: {
                color: '#606266'
              }
            },
            splitLine: {
              show: false
            },
            splitNumber: 20,
            min: 'dataMin',
            max: 'dataMax',
            axisPointer: {
              z: 100
            }
          },
          {
            type: 'category',
            gridIndex: 1,
            data: orginalData.categoryData,
            scale: true,
            boundaryGap: false,
            axisLine: { onZero: false },
            axisTick: { show: false },
            splitLine: { show: false },
            axisLabel: { show: false },
            splitNumber: 20,
            min: 'dataMin',
            max: 'dataMax'
          }
        ],
        yAxis: [
          {
            scale: true,
            splitArea: {
              show: true
            },
            axisLine: {
              onZero: false,
              lineStyle: {
                color: '#606266'
              }
            },
            position: "right"
          },
          {
            gridIndex: 1,
            splitNumber: 3,
            axisTick: { show: false },
            splitLine: { show: false },
            axisLabel: { show: true },
            position: "right"
          }
        ],
        dataZoom: [
          {
            type: "inside",
            start: 100,
            end: 80
          },
          {
            show: true,
            type: "slider",
            y: "90%",
            start: 50,
            end: 100
          },
          {
            show: false,
            xAxisIndex: [0, 1],
            type: "slider",
            start: 20,
            end: 100
          }
        ],
        series: [
          {
            name: "Daily Value",
            type: "candlestick",
            data: orginalData.values,
            itemStyle: {
              color: upColor,
              color0: downColor,
              borderColor: null,
              borderColor0: null
            },
            tooltip: {
              formatter: function (param) {
                param = param[0];
                return [
                  'Date: ' + param.name + '<hr size=1 style="margin: 3px 0;">',
                  'Open: ' + param.data[0] + '<br/>',
                  'Close: ' + param.data[1] + '<br/>',
                  'Lowest: ' + param.data[2] + '<br/>',
                  'Highest: ' + param.data[3] + '<br/>'
                ].join('');
              }
            }
          },
          {
            name: "MA5",
            type: "line",
            data: calculateMA(5),
            smooth: true,
            lineStyle: {
              normal: {
                opacity: 0.5
              }
            }
          },
          {
            name: "MA10",
            type: "line",
            data: calculateMA(10),
            smooth: true,
            lineStyle: {
              normal: {
                opacity: 0.5
              }
            }
          },
          {
            name: "MA20",
            type: "line",
            data: calculateMA(20),
            smooth: true,
            lineStyle: {
              normal: {
                opacity: 0.5
              }
            }
          },
          {
            name: "MA30",
            type: "line",
            data: calculateMA(30),
            smooth: true,
            lineStyle: {
              normal: {
                opacity: 0.5
              }
            }
          },
          {
            name: 'Volume',
            type: 'bar',
            xAxisIndex: 1,
            yAxisIndex: 1,
            data: orginalData.volumes
          }
        ]
      };
      // 进行初始化
      var charts = echarts.init(this.$refs.echartContainer);
      charts.setOption(option);
      charts.dispatchAction({
        type: 'brush',
        areas: [
          {
            brushType: 'lineX',
            coordRange: ['2016-7-15', '2016-7-20'],
            xAxisIndex: 0
          }
        ]
      });
    },
    methods: {
      splitData: function (rawData) {
        var categoryData = [];
        var values = [];
        var volumes = [];
        for (var i = 0; i < rawData.length; i++) {
          categoryData.push(rawData[i][1]);
          volumes.push([i, rawData[i][6], rawData[i][2] > rawData[i][3] ? 1 : -1]);
          values.push(rawData[i].splice(2, 4));
        }
        return {
          categoryData: categoryData,
          values: values,
          volumes: volumes,
        };
      },
      load_history() {
        var start_date_str = this.start_date.toISOString().substring(0, 10)
        axios({
          method: "GET",
          url: this.$hostname + this.basicDataApiPrefix + start_date_str + "/" + this.stock_ticker
        }).then(
          result => {
            if (result.data != null) {
              if (result.data.code == 200) {
                this.stock_data = result.data.data;
                this.$options.methods.sendSuccessMsg.bind(this)(result.data.msg);
              } else {
                this.$options.methods.sendErrorMsg.bind(this)(result.data.msg);
              }
            }
          },
          error => {
            this.$options.methods.sendErrorMsg.bind(this)(
              "Something wrong with the Ranking Historical Data."
            );
          }
        );
      },
      sendTips(msg) {
        const h = this.$createElement;
        this.$notify.success({
          title: 'Success',
          message: h('p', { style: 'font-size:12px' }, msg),
          duration: 1500
        });
      },
      sendAlert(msg) {
        const h = this.$createElement;
        this.$notify.warning({
          title: 'Warning',
          message: h('p', { style: 'font-size:12px' }, msg),
          duration: 1500
        });
      },
      sendSuccessMsg(msg) {
        this.$message.success({
          type: 'Success',
          message: msg
        });
      },
      sendErrorMsg(msg) {
        this.$message.warning({
          type: 'Warning',
          message: msg
        });
      },

    },
  }
</script>

<style scoped>
  #index_content {
    line-height: 380px;
  }

  .el-header {
    color: #333;
    text-align: center;
    line-height: 60px;
  }
</style>